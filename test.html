<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8" />
<title>iPhone WebAudio + Dictation test</title>
<style>
  body { font: 16px/1.4 system-ui, sans-serif; padding: 2rem; }
  textarea { width: 100%; height: 6rem; font: inherit; }
  button { margin-top: 1rem; font: inherit; padding: 0.4rem 0.8rem; }
</style>
<body>
  <h2>WebAudio + Dictation Test</h2>
  <p>1. Tap <b>Start Tone</b> (unmutes audio context).<br>
     2. Tap into the text box and start dictation (mic icon on iOS keyboard).<br>
     The sine tone should keep playing while speech-to-text runs.</p>

  <button id="start">Start Tone</button>
  <textarea id="box" placeholder="Tap mic icon and dictateâ€¦"></textarea>

<script>
let ctx, osc, gain;

document.getElementById('start').addEventListener('click', () => {
  if (!ctx) {
    ctx = new (window.AudioContext || window.webkitAudioContext)({ sampleRate: 44100 });
    gain = ctx.createGain();
    gain.gain.value = 0.1;
    osc = ctx.createOscillator();
    osc.type = 'sine';
    osc.frequency.value = 440; // A4 tone
    osc.connect(gain).connect(ctx.destination);
    osc.start();
  }
  if (ctx.state === 'suspended') ctx.resume();
});

document.getElementById('box').addEventListener('input', (e) => {
  // Read text safely while dictation runs; don't mutate it
  console.log('Current text:', e.target.value);
});

// Resume audio if Safari suspends it on tab change
document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'visible' && ctx?.state === 'suspended') ctx.resume();
});
window.addEventListener('pageshow', () => ctx?.resume());
</script>
</body>
</html>
